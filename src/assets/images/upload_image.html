<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="/assets/bb7fcfb5/jquery.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.form.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.storageapi.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.jsonp-2.4.0.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.base64.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/taskhelper.js?v409"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/touch-0.2.14.min_.js"></script>
<title>任务宽-AppStore五星好评上传截图</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
<link href="/themes/default/skins/webapp/css/common.css?0612" type="text/css" rel="stylesheet">
<script language="javascript">
<!--
$(function(){
  
//安装地址
$.taskHelper.setInstallUrl("http://web.doudou.com/webapp/ddquwan/guide/goinstallhelper"); 
/**
 * 修改BlockUI默认样式 
 */
$.extend($.blockUI.defaults, {
	fadeIn: 500,
	overlayCSS: {
		backgroundColor: '#000',
		opacity: 0.7,
		cursor: 'normal',
	},
	onOverlayClick: function (){
		$.unblockUI();
	},
	css: {
		width:'80%',
		maxWidth: '330px',
		padding: '15px 15px',
		margin:'0 0 0 -45%',
		textAlign: 'center',
		backgroundColor: '#fff',	
		cursor: 'normal',
		left: '50%',
		top: '50%',
		border: '1px solid #e8e8e8'
	}
});
});
//-->
</script>
</head>

<body>

<style type="text/css">
    #photoimg{ display: none; }
</style>
<!---最外边都要包一个pagewidth来限制页面最大宽度-->
<div class="pagewidth">
    <!--顶部导航-->
    <div class="header">
        <a  class="hd_back"><i></i></a>
        <h3>上传评论截图</h3>
    </div>

    <!--头部大图：截图图示说明-->
    <div class="comment_upload_case">
        <div class="comment_phone_box">
            <i class="comment_phone1"></i>
            <i class="comment_phone2"></i>
            <i class="comment_phone3"></i>
        </div>
        <p>截图范例</p>
    </div>

    <!--上传图片选框、上传图片注意事项-->
    <div class="comment_upload_btn_box">
        <form id="fileForm" method="post" enctype="multipart/form-data" action="">
        <div class="comment_upload_img">

            <!--图片上传有两种状态：第一种是还没上传，显示的是上面一个<span>;第二种是已上传，显示的是下面一个<span>。用style="display:none"来判断是否显示-->
<!--            <a class="comment_upload_del" style="position:relative;left:38px; bottom:10px">11</a>-->
            <span class="have_bgimg" style="display:block;" >
                 <img src="" id="hideImg">
                <a class="comment_upload_iadd"></a>上传截图

            </span>
            <input type="file" id="photoimg" name="img">
            <input type="hidden" value="15631" name="itemid">
            <span ><a></a><a class="comment_upload_del"></a></span>
        </div>

        <ul class="comment_upload_note">
            <li><em></em>请按给出的评论文案进行五星好评</li>
            <li><em></em>上传后不可更改，请上传有效截图</li>
        </ul>
    </div>

    <!--提交截图按钮-->
    <div class="task_info_btn comment_info_bot">
        <a class="btn_orange" id="sm" >提交截图</a>
    </div>
    </form>
    <!---弹出---简单弹出固定模板01--提醒是否删除照片-->
    <div class="remind_total remind_special"  style="display:none" >
        <div class="remind_total_top">
            <h6>温馨提醒</h6>
        </div>
        <div class="remind_text">
            <span>要删除这张照片吗？</span>
        </div>
        <div class="remind_foot">
            <input class="remind_btn" name="sub" value="确定删除" type="submit">
            <input class="remind_btn btn_one" name="sub" value="取消" type="submit">
        </div>
    </div>

    <!---弹出---提交截图成功提醒-->
    <div class="remind_total remind_ok remind_total_wider" style="display:none" >
        <div class="remind_ok_box">
            <span><i class="remind_ok1"></i></span>
            <h2>提交截图成功</h2>
            <p>请明日打开试玩【快3-专业竞彩利器】APP，再提交审核，任务宽将人工审核发放奖励</p>
            <dl>
                <dt>注意！！以下情况将无法获得奖励</dt>
                <dd>1，应用被卸载  </br>  2，评论被删除</br>     3，次日未打开应用</dd>
            </dl>
        </div>
        <div class="remind_foot">
            <!---这里的按钮统一用这种，有以下几种情况。与上面的文字相对应，这里所有的情况都只有一个按钮，方便看，就不归开div了---->
            <input  class="remind_btn btn_one" name="sub" value="知道了" type="submit">
        </div>
    </div>

    <!---弹出--助手未在线---->
    <div class="remind_total remind_total_tune" id="taskofflinePop" style="display:none" >
        <div class="remind_text" style="padding-bottom:10px;">
            <img src="/themes/default/skins/webapp/images/pop/task_pop_mobile_img.png" />
            <h5 style=" font-size:15px; color:#555;">未检测到助手在线，请打开助手</h5>
            <span style=" font-size:12px; color:#b5b5b5;">若重复提醒，请手动关闭再打开。</span>
        </div>
        <div class="remind_foot">
            <input  class="remind_btn btn_one" id="openHelperBtn" name="sub" value="打开助手" type="button">
            <span>若助手闪退或已卸载，请<a href="javascript:void(0);" class="goInstallHelper">重新下载</a></span>
        </div>
    </div>

    <!---弹出--助手升级---->
    <div class="remind_total remind_total_tune" id="taskUpgradePop" style="display:none">
        <!---这个关闭按钮看情况重要的更新强制升级，没有关闭按钮；不重要的更新加上关闭按钮---->
        <a class="pop_close" href="javascript:$('#taskUpgradePop,.z_box').hide();"></a>
        <div class="remind_text">
            <img src="/themes/default/skins/webapp/images/pop/task_pop_up_img.png"/>
            <h5>助手需升级才可正常使用</h5>
        </div>
        <div class="remind_foot">
            <input  class="remind_btn btn_one goInstallHelper" name="sub" value="升级助手" type="button">
            <span>直接链接appstore<a href="javascript:void(0);" class="goInstallHelper">升级助手</a></span>
        </div>
    </div>
    <!---黑色浮层---->
    <div class="z_box" style="display:none" ></div>
</div>


<script type="text/javascript">

    var _startprocess=0;
    var _helperVerion="1.6";
    // 检查助手是否开启
    var _checkTaskHelperOnline1=function ()
    {
        $.taskHelper.checkOnline(function (){
            _showTaskHelperOfflineTip(false);
            setTimeout(_checkTaskHelperOnline, 1000);
        }, function (){
            _showTaskHelperOfflineTip(true);
            setTimeout(_checkTaskHelperOnline, 1000);
        });
    }
    // 显示打开助手的提示
    var _showTaskHelperOfflineTip=function (offline)
    {
        if(typeof offline=='undefined' || offline==true){
            $(".newguide_one").hide();$("#taskofflinePop,.z_box").show();
        }else{
            $("#taskofflinePop,.z_box").hide();
        }
    }

    // 打开助手的事件
    $("#openHelperBtn").bind('click', function (){ $('#taskofflinePop,.z_box').hide();$.taskHelper.openHelper(); });
    // 安装助手的事件
    $(".goInstallHelper").bind('click', function (){ $.taskHelper.installHelper(); });


    $(".hd_back i").click(function(){
        location.href="/webapp/ddquwan/task/comment/detail?itemid="+15631;
    });

    /*简单上传预览插件*/
    $.fn.extend({
        uploadPreview: function (opts) {
            var _self = this,
                _this = $(this);
            opts = jQuery.extend({
                imgType: ["gif", "jpeg", "jpg", "bmp", "png"],
                success: function(){}
            }, opts || {});
            _self.getObjectURL = function (file) {
                var url = null;
                if (window.createObjectURL != undefined) {
                    url = window.createObjectURL(file)
                } else if (window.URL != undefined) {
                    url = window.URL.createObjectURL(file)
                } else if (window.webkitURL != undefined) {
                    url = window.webkitURL.createObjectURL(file)
                }
                return url
            };
            _this.change(function(){
                if (this.value) {
                    if (!RegExp("\.(" + opts.imgType.join("|") + ")$", "i").test(this.value.toLowerCase())) {
                        alert("选择文件错误,图片类型必须是" + opts.imgType.join("，") + "中的一种");
                        this.value = "";
                        return false
                    }
                    $('.tip').show();
                    opts.success.call(this, _self.getObjectURL(this.files[0]));
                }
            })
        }
    });

    $(document).ready(function() {
        $("#photoimg").uploadPreview({
            success: function(url){
                $(".have_bgimg img").attr('src',url).show();
            }
        });

        $(".have_bgimg").click(function(){
            $(this).find('img').hide();
            $('#photoimg').val("").click();
        });

        // 删除图片
        $(".comment_upload_del").click(function(){
            $(".remind_special,.z_box").show();
            $(".remind_btn").click(function(){
                $('.remind_special,.z_box').hide();
                $("#hideImg").hide();
            });
        });
    });

    $(function() {
        // 截图
        $("#sm").click(function () {
            var eventcp = 'eyJtIjoiZGRxdXdhbiIsInRyYWNraWQiOiI3YjlhYjA4MTE4YmJiOTc2IiwiaXRlbWlkIjoiMTU2MzEiLCJleHRyYXBhcmFtcyI6InByb2plY3RpZCUzRDExMTc3JTI2bWF0ZXJpYWxpZCUzRDE0NTE3JTI2c3BhY2VpZCUzRDEwMDAwMDAwJTI2d3hBcHBVc2VyaWQlM0QxMDIyNzM5NyUyNnBvaW50VXNlcmlkJTNEMTAyMjczOTciLCJ1cmxTY2hlbWVzIjpbIiJdLCJleGVjdXRhYmxlIjoidHQiLCJwYWNrYWdlTmFtZSI6ImNvbS5jcHpqbHFrMy5pb3MifQ%3D%3D';
            // 检测用户是否安装
            $.taskHelper.dispatchInstalled(eventcp, function (calldata) {
                // 判断当前用户是否安装了该应用
                var _status = $.base64('decode', calldata.status, true);
                // 未安装应用
                if (_status != 1) {
                    alert("亲爱的，您尙未安装该应用。需安装应用，并在AppStore上对该应用五星好评才可上传截图~");
                    $.taskHelper.openUrl("https://itunes.apple.com/cn/app/id1241606241?mt=8", function () {
                    }, function () {
                        _showTaskHelperOfflineTip();
                    });
                } else {
                    // 检测到用户已经安装了该应用跳转到截图页面
                    var options = {
                        type: "POST",
                        dataType: "json",
                        url: "/webapp/ddquwan/task/comment/sm",
                        resetForm: true,
                        success: function (result) {
                            if(result.status==1){
                                $(".remind_total_wider,.z_box").show();
                                $(".btn_one").click(function(){
                                    window.location="/webapp/ddquwan/task/comment/index";
                                });
                            }else{
                                alert(result.message);
                            }
                        }
                    };
                    $("#fileForm").ajaxSubmit(options);
                }
            }, function () {
                // 打开失败
                _showTaskHelperOfflineTip();
            });
        });
    });

</script>
</body>
</html>
